# Руководство пользователя: Система приёма ТМЦ на склад

## 1. Назначение системы

Система предназначена для операторов склада, которые принимают товарно-материальные ценности (ТМЦ) по накладным (ТТН).  
Система помогает:

- загружать электронные документы ТТН (PDF/изображения);
- автоматически распознавать позиции товаров;
- исправлять ошибки распознавания;
- выполнять входной контроль по выбранным позициям с видеозаписью;
- хранить историю приёмок и результатов контроля.

## 2. Запуск системы

Система состоит из двух частей:

- сервера (backend),
- клиентского приложения (GUI для оператора).

В тестовой версии они запускаются отдельно.

### 2.1. Запуск сервера

1. Откройте файл `run_server.bat` (двойной клик)  
   или запустите команду из терминала:

   ```bash
   python -m server.src.main_server
   ```

2. В окне терминала вы увидите, что сервер слушает адрес вида:

   ```
   http://127.0.0.1:8000
   ```

3. Для проверки можно открыть в браузере:

   ```
   http://127.0.0.1:8000/api/v1/health
   ```

   Если всё в порядке, сервер вернёт:

   ```json
   {
     "status": "ok",
     "time": "..."
   }
   ```

### 2.2. Запуск клиента

1. Запустите `run_client.bat`  
   или команду:

   ```bash
   python -m client.src.main_client
   ```

2. Откроется главное окно приложения.

Если сервер ещё не запущен, клиент покажет ошибку подключения. В этом случае сначала запустите сервер, затем клиента.

## 3. Главное окно

В главном окне доступны основные элементы:

- **Кнопка "Принять ТМЦ на склад"** — начало новой приёмки.
- **Кнопка "История приёмок"** — просмотр уже созданных приёмок.
- **Кнопка "Настройки"** — базовые настройки (путь к данным, выбор камеры, при необходимости).

Внизу окна отображается **строка состояния**:

- состояние подключения к серверу (онлайн/офлайн),
- состояние камеры (доступна/нет),
- статус OCR (готов/ошибка).

## 4. Создание новой приёмки

1. Нажмите кнопку **"Принять ТМЦ на склад"**.
2. Откроется диалог **"Документ ТТН"**.
3. Выберите тип файла:
   - **PDF** — накладная в формате PDF;
   - **Изображение** — скан или фото накладной (JPG/PNG и т.п.).

4. После выбора файла вы увидите:
   - миниатюру документа (если реализована),
   - путь к выбранному файлу.

5. Нажмите кнопку **"Распознать"**:
   - система применит OCR (распознавание текста);
   - увидит табличную часть с позициями;
   - выдаст список позиций в таблице.

6. В таблице позиций:
   - поля, которые были распознаны с низкой уверенностью (например, артикул или количество), будут выделены (цветом/иконкой);
   - вы можете отредактировать любые поля:
     - артикул,
     - наименование,
     - количество,
     - единицу измерения.

7. После проверки данных нажмите **"Создать приёмку"**:
   - система отправит отредактированные данные на сервер;
   - создаст запись приёмки и сохранит исходный документ;
   - приёмка появится в истории.

## 5. Входной контроль и видеозапись

Если некоторые позиции требуют входного контроля (например, проверка веса или количества):

1. После создания приёмки откройте диалог **"Входной контроль"** (обычно автоматически или по кнопке).
2. В окне контроля:
   - отображается список позиций, которые нужно проверить;
   - показываются инструкции по контролю (например, "взвесить партию, проверить допуск").

3. Перед началом проверки:
   - убедитесь, что камера подключена;
   - при необходимости выберите нужную камеру в настройках.

4. Нажмите **"Начать контроль"**:
   - включится превью с камеры;
   - начнётся запись видео.

5. Для каждой позиции:
   - выполните измерения (вес, количество и т.п.);
   - введите фактические значения в поля;
   - нажмите **"Прошёл"** или **"Не прошёл"**.

6. По завершении всех позиций:
   - нажмите кнопку **"Завершить контроль"**;
   - запись видео остановится;
   - видео будет сохранено и отправлено на сервер вместе с результатами контроля.

## 6. Просмотр истории приёмок

1. Нажмите кнопку **"История приёмок"**.
2. Откроется список приёмок с полями:
   - номер ТТН,
   - дата,
   - поставщик,
   - статус (в ожидании / в процессе / завершена / синхронизирована).

3. Выберите интересующую приёмку:
   - система загрузит подробные данные с сервера;
   - отобразит список позиций и статусы контроля по каждой.

4. При необходимости можно просмотреть:
   - результаты контроля (примечания, измерения);
   - статус загрузки документа и видео.

## 7. Типичные проблемы и их решение

### 7.1. Сервер недоступен

Симптомы:

- В строке состояния — индикатор "сервер недоступен".
- При попытке создать приёмку — ошибка.

Действия:

1. Проверьте, запущен ли сервер (окно с Uvicorn / run_server.bat).
2. При необходимости перезапустите сервер.
3. Нажмите кнопку повторной попытки в клиенте (если предусмотрена) или перезапустите клиент.

### 7.2. Нет камеры

Симптомы:

- В настройках нет доступных камер.
- При запуске контроля видео не появляется.

Действия:

1. Проверьте подключение камеры к компьютеру.
2. Закройте другие программы, которые могут использовать камеру (Skype, Zoom и т.п.).
3. Перезапустите клиент.
4. При необходимости выполните контроль без видео (если это допустимо в рамках тестового задания).

### 7.3. Низкое качество распознавания (OCR)

Симптомы:

- Много жёлтых/красных полей (сомнительные данные).
- Ошибки в артикулах или количествах.

Действия:

1. Проверьте качество исходного файла (чёткость, отсутствие сильных наклонов).
2. По возможности используйте PDF с "живым" текстом вместо фотографий.
3. Внимательно проверьте и исправьте все подсвеченные поля вручную.
4. При необходимости повторно загрузите другой вариант документа.

## 8. Завершение работы

1. Закройте окно клиента (GUI).
2. Остановите сервер:
   - закройте окно терминала с Uvicorn,
   - или нажмите Ctrl+C в консоли.

Все данные (приёмки, товары, файлы) останутся на диске и будут доступны при следующем запуске.
