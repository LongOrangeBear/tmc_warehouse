name: Build Portable Windows

on:
  push:
    branches: [ master, main ]
    tags: [ 'v*.*.*' ]
  workflow_dispatch:  # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ

env:
  PYTHON_VERSION: '3.12'
  TESSERACT_VERSION: '5.3.3'
  POPPLER_VERSION: '24.02.0'

jobs:
  build-portable:
    name: Build Portable Windows Package
    runs-on: windows-latest
    
    steps:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 1. ĞŸĞĞ”Ğ“ĞĞ¢ĞĞ’ĞšĞ
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'

      - name: Get version
        id: version
        shell: powershell
        run: |
          if ("${{ github.ref }}" -match "refs/tags/v(.+)") {
            $version = $matches[1]
          } else {
            $sha = "${{ github.sha }}".Substring(0,7)
            $version = "dev-$sha"
          }
          echo "VERSION=$version" >> $env:GITHUB_OUTPUT
          echo "Building version: $version"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 2. Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ Ğ—ĞĞ’Ğ˜Ğ¡Ğ˜ĞœĞĞ¡Ğ¢Ğ•Ğ™
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Install Python dependencies
        shell: powershell
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller==6.3.0

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 3. Ğ¡ĞšĞĞ§Ğ˜Ğ’ĞĞĞ˜Ğ• TESSERACT (PORTABLE)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Download Tesseract Portable
        shell: powershell
        run: |
          Write-Host "Downloading Tesseract ${{ env.TESSERACT_VERSION }}..."
          
          # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ UB-Mannheim installer
          $url = "https://digi.bib.uni-mannheim.de/tesseract/tesseract-ocr-w64-setup-${{ env.TESSERACT_VERSION }}.20231005.exe"
          $installer = "tesseract-installer.exe"
          
          Invoke-WebRequest -Uri $url -OutFile $installer
          
          # Ğ¢Ğ¸Ñ…Ğ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ² temp Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
          Start-Process -FilePath $installer -ArgumentList "/S","/D=$PWD\tesseract-temp" -Wait
          
          # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ (Ğ±ĞµĞ· ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ°)
          New-Item -ItemType Directory -Force -Path "portable\Tesseract-OCR"
          Copy-Item -Path "tesseract-temp\*" -Destination "portable\Tesseract-OCR" -Recurse
          
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
          if (Test-Path "portable\Tesseract-OCR\tesseract.exe") {
            Write-Host "âœ“ Tesseract downloaded successfully"
            & "portable\Tesseract-OCR\tesseract.exe" --version
          } else {
            Write-Error "Failed to download Tesseract"
            exit 1
          }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 4. Ğ¡ĞšĞĞ§Ğ˜Ğ’ĞĞĞ˜Ğ• POPPLER (PORTABLE)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Download Poppler Portable
        shell: powershell
        run: |
          Write-Host "Downloading Poppler ${{ env.POPPLER_VERSION }}..."
          
          # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ oschwartz10612 Windows builds
          $url = "https://github.com/oschwartz10612/poppler-windows/releases/download/v${{ env.POPPLER_VERSION }}-0/Release-${{ env.POPPLER_VERSION }}-0.zip"
          $zip = "poppler.zip"
          
          Invoke-WebRequest -Uri $url -OutFile $zip
          
          # Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ
          Expand-Archive -Path $zip -DestinationPath "poppler-temp"
          
          # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Library (Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ğ¸ĞºĞ¸)
          New-Item -ItemType Directory -Force -Path "portable\poppler"
          Copy-Item -Path "poppler-temp\poppler-${{ env.POPPLER_VERSION }}\Library\*" -Destination "portable\poppler" -Recurse
          
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
          if (Test-Path "portable\poppler\bin\pdftoppm.exe") {
            Write-Host "âœ“ Poppler downloaded successfully"
            & "portable\poppler\bin\pdftoppm.exe" -v
          } else {
            Write-Error "Failed to download Poppler"
            exit 1
          }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 5. Ğ¡Ğ‘ĞĞ ĞšĞ EXE Ğ¤ĞĞ™Ğ›ĞĞ’
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Build Server EXE
        shell: powershell
        run: |
          Write-Host "Building tmc_server.exe..."
          pyinstaller `
            --onefile `
            --name "tmc_server" `
            --add-data "common;common" `
            --hidden-import "peewee" `
            --hidden-import "uvicorn.logging" `
            --hidden-import "uvicorn.loops" `
            --hidden-import "uvicorn.loops.auto" `
            --hidden-import "uvicorn.protocols" `
            --hidden-import "uvicorn.protocols.http" `
            --hidden-import "uvicorn.protocols.http.auto" `
            --hidden-import "uvicorn.protocols.websockets" `
            --hidden-import "uvicorn.protocols.websockets.auto" `
            --hidden-import "uvicorn.lifespan" `
            --hidden-import "uvicorn.lifespan.on" `
            --console `
            server/src/main_server.py
          
          if (Test-Path "dist\tmc_server.exe") {
            Write-Host "âœ“ Server EXE built successfully"
          } else {
            Write-Error "Failed to build server EXE"
            exit 1
          }

      - name: Build Client EXE
        shell: powershell
        run: |
          Write-Host "Building tmc_client.exe..."
          pyinstaller `
            --onefile `
            --windowed `
            --name "tmc_client" `
            --add-data "common;common" `
            --hidden-import "PySide6.QtCore" `
            --hidden-import "PySide6.QtGui" `
            --hidden-import "PySide6.QtWidgets" `
            --hidden-import "cv2" `
            --hidden-import "pytesseract" `
            --hidden-import "pdf2image" `
            client/src/main_client.py
          
          if (Test-Path "dist\tmc_client.exe") {
            Write-Host "âœ“ Client EXE built successfully"
          } else {
            Write-Error "Failed to build client EXE"
            exit 1
          }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 6. Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• PORTABLE ĞŸĞĞšĞ•Ğ¢Ğ
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Create Portable Package
        shell: powershell
        run: |
          $packageDir = "dist\TMC_Warehouse_Portable"
          
          Write-Host "Creating portable package structure..."
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ
          New-Item -ItemType Directory -Force -Path $packageDir
          
          # ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ EXE
          Copy-Item "dist\tmc_server.exe" $packageDir
          Copy-Item "dist\tmc_client.exe" $packageDir
          
          # ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Tesseract Ğ¸ Poppler
          Copy-Item -Path "portable\Tesseract-OCR" -Destination "$packageDir\Tesseract-OCR" -Recurse
          Copy-Item -Path "portable\poppler" -Destination "$packageDir\poppler" -Recurse
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ config Ñ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿ÑƒÑ‚ÑĞ¼Ğ¸
          New-Item -ItemType Directory -Force -Path "$packageDir\config"
          
          $config = @"
          {
            "app": {
              "name": "TMC Warehouse",
              "version": "${{ steps.version.outputs.VERSION }}",
              "language": "ru"
            },
            "paths": {
              "database": "data/database/warehouse.db",
              "receipts_root": "data/receipts",
              "logs": "data/logs"
            },
            "tesseract": {
              "path": "./Tesseract-OCR/tesseract.exe",
              "languages": ["rus"],
              "psm": 6
            },
            "poppler": {
              "path": "./poppler/bin"
            },
            "camera": {
              "default_index": 0,
              "resolution": [1280, 720],
              "fps": 30,
              "codec": "MJPG",
              "container": "avi"
            },
            "server": {
              "host": "127.0.0.1",
              "port": 8000,
              "base_url": "http://127.0.0.1:8000/api/v1",
              "timeout": 30
            },
            "sync": {
              "retry_count": 3,
              "retry_delay": 5
            },
            "validation": {
              "control_types": {
                "weight_check": {
                  "description": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ĞµÑĞ°",
                  "params": ["target_weight", "tolerance"]
                },
                "visual_check": {
                  "description": "Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",
                  "params": ["checklist"]
                },
                "dimension_check": {
                  "description": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ²",
                  "params": ["length", "width", "height", "tolerance"]
                },
                "quantity_check": {
                  "description": "ĞŸĞµÑ€ĞµÑÑ‡Ñ‘Ñ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°",
                  "params": ["expected_count"]
                }
              }
            }
          }
          "@
          $config | Out-File -FilePath "$packageDir\config\config.json" -Encoding UTF8
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
          New-Item -ItemType Directory -Force -Path "$packageDir\data\database"
          New-Item -ItemType Directory -Force -Path "$packageDir\data\receipts"
          New-Item -ItemType Directory -Force -Path "$packageDir\data\logs"
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ BAT Ñ„Ğ°Ğ¹Ğ»Ñ‹
          @"
          @echo off
          echo Starting TMC Warehouse Server...
          echo.
          echo Server URL: http://127.0.0.1:8000
          echo Press Ctrl+C to stop
          echo.
          tmc_server.exe
          pause
          "@ | Out-File -FilePath "$packageDir\START_SERVER.bat" -Encoding ASCII
          
          @"
          @echo off
          echo Starting TMC Warehouse Client...
          echo.
          start tmc_client.exe
          "@ | Out-File -FilePath "$packageDir\START_CLIENT.bat" -Encoding ASCII
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ README
          @"
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            TMC WAREHOUSE SYSTEM - PORTABLE VERSION v${{ steps.version.outputs.VERSION }}
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          ğŸš€ Ğ‘Ğ«Ğ¡Ğ¢Ğ Ğ«Ğ™ Ğ¡Ğ¢ĞĞ Ğ¢:

            1. Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ ĞºĞ»Ğ¸Ğº Ğ¿Ğ¾ START_SERVER.bat (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼)
            2. Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ ĞºĞ»Ğ¸Ğº Ğ¿Ğ¾ START_CLIENT.bat
            3. Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ğŸ“ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞŸĞĞŸĞĞš:

            TMC_Warehouse_Portable/
            â”œâ”€â”€ tmc_server.exe       - Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
            â”œâ”€â”€ tmc_client.exe       - ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
            â”œâ”€â”€ START_SERVER.bat     - Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²ĞµÑ€Ğ°
            â”œâ”€â”€ START_CLIENT.bat     - Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
            â”œâ”€â”€ Tesseract-OCR/       - OCR Ğ´Ğ²Ğ¸Ğ¶Ğ¾Ğº (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½)
            â”œâ”€â”€ poppler/             - PDF ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€ (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½)
            â”œâ”€â”€ config/
            â”‚   â””â”€â”€ config.json      - ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
            â””â”€â”€ data/                - Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          âš™ï¸ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):

            ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ: config/config.json
            
            Ğ’ÑĞµ Ğ¿ÑƒÑ‚Ğ¸ ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.
            ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ğŸ’¡ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞ«Ğ• Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞĞ˜Ğ¯:

            - Windows 10/11 (64-bit)
            - 4 GB RAM (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ 8 GB)
            - 500 MB ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ°
            - Ğ’ĞµĞ±-ĞºĞ°Ğ¼ĞµÑ€Ğ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ğŸ“ Ğ›Ğ˜Ğ¦Ğ•ĞĞ—Ğ˜Ğ˜:

            TMC Warehouse:  Ğ¡Ğ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
            Tesseract OCR:  Apache License 2.0
            Poppler:        GPL v2

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ğŸ› ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ«:

            1. ĞĞºĞ½Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° ÑÑ€Ğ°Ğ·Ñƒ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ:
               - ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ START_SERVER.bat Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
               - ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
            
            2. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ:
               - Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ (Ğ¾ĞºĞ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾)
            
            3. ĞĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ°Ğ¼ĞµÑ€Ğ°:
               - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… Windows Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ ĞºĞ°Ğ¼ĞµÑ€Ñ‹
            
            4. ĞÑˆĞ¸Ğ±ĞºĞ° OCR:
               - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿ÑƒÑ‚ÑŒ tesseract Ğ² config.json

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          Built on: $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")
          Version:  ${{ steps.version.outputs.VERSION }}

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          "@ | Out-File -FilePath "$packageDir\README.txt" -Encoding UTF8
          
          Write-Host "âœ“ Package structure created"
          
          # ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹
          Write-Host "`nĞŸĞ°ĞºĞµÑ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²:"
          Get-ChildItem $packageDir -Recurse | Measure-Object -Property Length -Sum | 
            ForEach-Object { "Total size: {0:N2} MB" -f ($_.Sum / 1MB) }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 7. Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• ĞĞ Ğ¥Ğ˜Ğ’Ğ
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Create ZIP Archive
        shell: powershell
        run: |
          $zipName = "TMC_Warehouse_Portable_v${{ steps.version.outputs.VERSION }}_Windows_x64.zip"
          Write-Host "Creating archive: $zipName"
          
          Compress-Archive `
            -Path "dist\TMC_Warehouse_Portable\*" `
            -DestinationPath "dist\$zipName" `
            -CompressionLevel Optimal
          
          if (Test-Path "dist\$zipName") {
            $size = (Get-Item "dist\$zipName").Length / 1MB
            Write-Host "âœ“ Archive created successfully: {0:N2} MB" -f $size
          } else {
            Write-Error "Failed to create archive"
            exit 1
          }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 8. Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ ĞĞ Ğ¢Ğ•Ğ¤ĞĞšĞ¢ĞĞ’
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Upload Portable Package
        uses: actions/upload-artifact@v4
        with:
          name: TMC-Warehouse-Portable-${{ steps.version.outputs.VERSION }}
          path: dist/*.zip
          retention-days: 90

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 9. Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• GITHUB RELEASE (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ‚ĞµĞ³Ğ¾Ğ²)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - name: Create GitHub Release
        if: startsWith(github.ref, 'refs/tags/v')
        uses: softprops/action-gh-release@v1
        with:
          name: TMC Warehouse Portable v${{ steps.version.outputs.VERSION }}
          body: |
            ## ğŸ‰ TMC Warehouse System - Portable Edition
            
            ### ğŸ“¦ ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ
            
            Ğ­Ñ‚Ğ¾Ñ‚ Ñ€ĞµĞ»Ğ¸Ğ· Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ **Ğ²ÑÑ‘ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾Ğµ** Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğµ:
            - âœ… tmc_server.exe
            - âœ… tmc_client.exe  
            - âœ… Tesseract OCR (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½)
            - âœ… Poppler (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½)
            - âœ… ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
            
            ### ğŸš€ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
            
            1. Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ `TMC_Warehouse_Portable_v${{ steps.version.outputs.VERSION }}_Windows_x64.zip`
            2. Ğ Ğ°ÑĞ¿Ğ°ĞºÑƒĞ¹Ñ‚Ğµ Ğ² Ğ»ÑĞ±ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
            3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ `START_SERVER.bat`
            4. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ `START_CLIENT.bat`
            5. **Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!** ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.
            
            ### ğŸ’» Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
            
            - Windows 10/11 (64-bit)
            - 4 GB RAM
            - 500 MB ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ°
            
            ### ğŸ“ ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ
            
            - Portable Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ°
            - ĞœĞ¾Ğ¶Ğ½Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€Ñ‹
            - Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°: ~150-200 MB
            
            ---
            
            **Ğ’ĞµÑ€ÑĞ¸Ñ**: ${{ steps.version.outputs.VERSION }}  
            **Ğ”Ğ°Ñ‚Ğ° ÑĞ±Ğ¾Ñ€ĞºĞ¸**: ${{ github.event.head_commit.timestamp }}
          files: |
            dist/*.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
